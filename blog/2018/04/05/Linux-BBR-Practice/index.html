<!DOCTYPE html>
<html lang="en">

<!-- header -->
<head>
    <title>Emanci - PHP Developer</title>
    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="emanci - PHP Developer">
    <meta name="author" content="emanci">
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,500,400italic,300italic,300,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
    <!-- Global CSS -->
    <link rel="stylesheet" href="/plugins/bootstrap/css/bootstrap.min.css">
    
    <!-- Plugins CSS -->
    <link rel="stylesheet" href="/plugins/font-awesome/css/font-awesome.css">

    <!-- Theme CSS -->
    <link rel="stylesheet" href="/css/styles-13.css">
    <link rel="stylesheet" href="/css/custom.css">

    <link href="https://plus.google.com/+MichaelPeacock" rel="author" />
    <link href="https://plus.google.com/+MichaelPeacock" rel="publisher" />
    <script defer src="https://use.fontawesome.com/releases/v5.0.9/js/all.js" integrity="sha384-8iPTk2s/jMVj81dnzb/iFR2sdA7u06vHJyyLlAd4snFpCl/SnyUjRrbdJsw1pGIl" crossorigin="anonymous"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>


<body class="{{ page.body_class }}">

    <!-- content -->
    <header class="header">
    <div class="top-bar container-fluid static">
        <ul class="nav page-nav list-inline menu-left pull-left" >
            <li class="nav-item"><a class="nav-link" href="/"><img src="https://s.gravatar.com/avatar/ce0bc70d67e11eb7d5898f548d457f05?s=73" alt="..." class="rounded-circle"></a></li>
            <li class="nav-item" style="padding-top: 20px;"><a class="nav-link" href="/">emanci</a></li>
        </ul>

        <!-- nav -->
        <ul id="page-nav" class="nav page-nav list-inline pull-right menu-right">
    <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
    <li class="nav-item"><a class="nav-link" href="/blog">Blog</a></li>
    <li class="nav-item"><a class="nav-link" href="/about">About</a></li>
    <li class="nav-item"><a class="nav-link" href="https://github.com/emanci"><i class="fab fa-github"></i></a></li>
</ul>


        <div style="clear: both;"></div>
    </div><!--//top-bar-->
</header><!--//header-->

    <div class="wrapper container main-content-wrapper">
    <section class="section">
        <h1 class="section-title">Linux BBR 实践</h1>

        <p>BBR 的作用就是加速 TCP，即：尽可能的充分利用带宽；降低 buffer 占用率，从而降低延迟。</p>
<a id="more"></a>
<p>升级前下载速度</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[download] 100% of 171.28MiB <span class="keyword">in</span> 00:40</span><br><span class="line">[1]-  Done                    sudo youtube-dl https://www.youtube.com/watch?v=4SdcmxGC3Yc</span><br><span class="line">[2]+  Done                    list=PLo7mBDsRHu11Szh1t-CRqwliRGRA1JOZJ</span><br></pre></td></tr></table></figure>
<p>升级后下载速度</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[download] 100% of 171.28MiB <span class="keyword">in</span> 00:08</span><br><span class="line">[1]-  Done                    sudo youtube-dl https://www.youtube.com/watch?v=4SdcmxGC3Yc</span><br><span class="line">[2]+  Done                    list=PLo7mBDsRHu11Szh1t-CRqwliRGRA1JOZJ</span><br></pre></td></tr></table></figure>
<p>升级前的准备</p>
<p>系统内核要求：Linux kernel 4.9 及以上</p>
<p>检查系统内核版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -r</span><br></pre></td></tr></table></figure>
<p>如果系统版本不满足要求，先升级内核：<br>在 内核下载地址 里找到你要用的内核，即 4.9+ 版本。 另外你要注意：<br>如果系统是 64 位，则下载 amd64 的 linux-image 中含有 generic 这个 deb 包；<br>如果系统是 32 位，则下载 i386 的 linux-image 中含有 generic 这个 deb 包 这里我使用的是 4.10 版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo wget http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.10/linux-image-4.10.0-041000-generic_4.10.0-041000.201702191831_amd64.deb</span><br><span class="line">sudo dpkg -i linux-image-4.10.0-041000-generic_4.10.0-041000.201702191831_amd64.deb</span><br><span class="line">sudo update-grub</span><br><span class="line">sudo reboot</span><br></pre></td></tr></table></figure>
<p>安装（开启） BBR</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"net.core.default_qdisc=fq"</span> &gt;&gt; /etc/sysctl.conf  </span><br><span class="line"><span class="built_in">echo</span> <span class="string">"net.ipv4.tcp_congestion_control=bbr"</span> &gt;&gt; /etc/sysctl.conf  </span><br><span class="line">sysctl -p  <span class="comment"># 立即生效配置</span></span><br></pre></td></tr></table></figure>
<p>内核是否已开启 BBR</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sysctl net.ipv4.tcp_available_congestion_control  </span><br><span class="line">sysctl net.ipv4.tcp_congestion_control</span><br></pre></td></tr></table></figure>
<p>当前内核是否载入 tcp_bbr 模块</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsmod | grep bbr</span><br></pre></td></tr></table></figure>
<h3 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h3><ul>
<li><a href="http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.10" target="_blank" rel="noopener">内核下载地址</a></li>
<li><a href="https://github.com/iMeiji/shadowsocks_install/wiki/%E5%BC%80%E5%90%AFTCP-BBR%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E7%AE%97%E6%B3%95" target="_blank" rel="noopener">开启TCP BBR拥塞控制算法</a></li>
<li><a href="https://www.zhihu.com/question/53559433" target="_blank" rel="noopener">Linux Kernel 4.9 中的 BBR 算法与之前的 TCP 拥塞控制相比有什么优势？</a></li>
</ul>


        <p>Published 2018-04-05</p>

    </section>
</div>



    <!-- footer -->
    <footer class="footer text-center">
    <div class="container">
        <small class="copyright">&copy; 2018 emanci</small>
    </div><!--//container-->
</footer>


    <!-- Javascript -->
    <script src="/plugins/jquery-3.2.1.min.js"></script>
    <script src="/plugins/popper.min.js"></script>
    <script src="/plugins/bootstrap/js/bootstrap.min.js"></script>
    <script src="/plugins/back-to-top.js"></script>
    <script src="/plugins/jquery-scrollTo/jquery.scrollTo.min.js"></script>
    <script src="/plugins/imagesloaded.pkgd.min.js"></script>
    <script src="/plugins/isotope.pkgd.min.js"></script>

    <!-- custom js -->
    <script src="/js/main.js"></script>

    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-12100402-1', 'michaelpeacock.co.uk');
        ga('send', 'pageview');
    </script>
</body>
</html>
